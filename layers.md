## LAMBDA LAYERS

When building a lambda, especially in Python, you may need to use a layer in order to include external dependencies. Here is a step by step guide on how to create a lambda layer using the example of the 'requests' import for a python 3.10 lambda.


1. Create directory for your layer   
`mkdirÂ  python_requests`
2. Create a lambda layer folder structure inside that directory. This is important. Lambda functions are looking in a specific place for the layer functionality; therefore you must match the expected folder structure exactly. AWS gives detail on what's expected for python as well as other languages in one of the links below   
`cd python_requests`   
`mkdir python`   
`cd python`   
`mkdir lib`   
`cd lib`  
`mkdir python3.10`  
`cd python3.10`
3. Create and activate a virtual environment. I usually do this in a separate temp directory  
`python -m venv venv`   
`cd venv`   
WINDOWS: `./Scripts/activate`  
MAC: `source venv/bin/activate`
4. Install the needed import using pip
`pip install requests`
5. This creates a site-packages folder in the venv/Lib directory. Copy that folder to python3.10 to create a folder structure looking like this   
`python_requests/python/lib/python3.10/site-packages`
6. Feel free to remove any unneeded imports from the site-packages directory
7. Zip up the directory. This will create a zip file under python_requests. NOTE: Windows users must run this in a bash shell.   
`cd python_requests`  
`zip requests.zip . -r`
8. Upload this zip to the AWS console under layers and attach to your lambda function   
- To upload to AWS using terraform, use a resource like this in your regional/main.tf. Make sure the file you zipped in step 7 exists in your project's folder structure.

```
resource "aws_lambda_layer_version" "lambda_layer" {   
  filename   = "./requests.zip"   
  layer_name = "requests"
  compatible_architectures = ["x86_64", "arm64"]
  compatible_runtimes = ["python3.9", "python3.10"] 
}
```